<sheet version="8" app_version="24.5">
<markup version="1" identifier="markdownxl" displayName="Markdown XL">
	<tag definition="heading1" pattern="#"></tag>
	<tag definition="heading2" pattern="##"></tag>
	<tag definition="heading3" pattern="###"></tag>
	<tag definition="heading4" pattern="####"></tag>
	<tag definition="heading5" pattern="#####"></tag>
	<tag definition="heading6" pattern="######"></tag>
	<tag definition="codeblock" pattern="''"></tag>
	<tag definition="codeblock" pattern="``"></tag>
	<tag definition="comment" pattern="%%"></tag>
	<tag definition="nativeblock" pattern="~~"></tag>
	<tag definition="blockquote" pattern="&gt;"></tag>
	<tag definition="orderedList" pattern="\d."></tag>
	<tag definition="unorderedList" pattern="*"></tag>
	<tag definition="unorderedList" pattern="+"></tag>
	<tag definition="unorderedList" pattern="-"></tag>
	<tag definition="divider" pattern="----"></tag>
	<tag definition="filename" pattern="@:"></tag>
	<tag definition="code" startPattern="`" endPattern="`"></tag>
	<tag definition="delete" startPattern="||" endPattern="||"></tag>
	<tag definition="emph" startPattern="*" endPattern="*"></tag>
	<tag definition="emph" startPattern="_" endPattern="_"></tag>
	<tag definition="inlineComment" startPattern="++" endPattern="++"></tag>
	<tag definition="inlineNative" startPattern="~" endPattern="~"></tag>
	<tag definition="mark" startPattern="::" endPattern="::"></tag>
	<tag definition="strong" startPattern="__" endPattern="__"></tag>
	<tag definition="strong" startPattern="**" endPattern="**"></tag>
	<tag definition="annotation" startPattern="{" endPattern="}"></tag>
	<tag definition="link" startPattern="[" endPattern="]"></tag>
	<tag definition="footnote" pattern="(fn)"></tag>
	<tag definition="image" pattern="(img)"></tag>
	<tag definition="video" pattern="(vid)"></tag>
</markup>
<string xml:space="preserve">
<p><element kind="inlineComment" startTag="++" endTag="++">COVID-19</element></p>
<p></p>
<p><tags><tag kind="nativeblock">￼</tag></tags>&lt;script src="https://polyfill.io/v3/polyfill.min.js?features=es6"&gt;&lt;/script&gt;</p>
<p><tags><tag kind="nativeblock">￼</tag></tags>&lt;script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"&gt;&lt;/script&gt;</p>
<p></p>
<p></p>
<p><tags><tag kind="heading1">#</tag></tags>Data analysis exercise: <element kind="inlineNative" startTag="~" endTag="~">&lt;/br&gt;</element> COVID-19 in México</p>
<p></p>
<p><tags><tag kind="heading6">######</tag></tags>Alejandro Osornio<element kind="inlineNative" startTag="~" endTag="~">&lt;/br&gt;</element>December 2021 – January 2022</p>
<p></p>
<p><tags><tag kind="heading4">####</tag></tags><element kind="inlineNative" startTag="~" endTag="~">&lt;/br&gt;</element> Abstract</p>
<p>COVID-19 reached every place on the earth. An examination of open data from México will reveal the situation there. This paper aims to describe it by showing plenty of plots and graphs, explaining how to develop them in the process.</p>
<p>The purpose, to strengthen my general analysis skills, practicing methods used to produce high-quality materials like this web page and the media displayed in it.</p>
<p></p>
<p><tags><tag kind="heading2">##</tag></tags>Regarding the data</p>
<p>The CSV was uploaded by José Héctor Paredes Martínez, Epidemiological Notification and Registry Director of the Secretaría de Salud at Mexico’s government.</p>
<p>Composed of 12,133,530 lines, the database contains a variety of information like death dates, gender, whether intubation was required, nationality, and more input which help get an idea of the situation in México.</p>
<p>I manipulated the material with <element kind="strong" startTag="**" endTag="**">Wolfram Mathematica</element> 13.0.0, fragmenting the rows with the rust crate, <element kind="strong" startTag="**" endTag="**">split-csv</element>, into 101 smaller documents for easier processing.</p>
<p></p>
<p>It’s necessary to divide the 2 GB single archive since trying to import all 12 million registers at once into a dataset fails after more than 30 minutes because of massive virtual memory space required. By splitting the contents, I gain speed and flexibility when coding due to low loading times and memory usage per file.</p>
<p></p>
<p><tags><tag kind="heading2">##</tag></tags>Counting</p>
<p></p>
<p>This first section visualizes basic information, counting the number of people that full-fills a condition.</p>
<p></p>
<p><element kind="inlineNative" startTag="~" endTag="~">&lt;/br&gt;</element><element kind="strong" startTag="**" endTag="**">All-time attendants</element></p>
<p></p>
<p>All 12 million rows correspond to an individual visit to an attention unit. To get the evolution of entrance at health centers, we can use the following code.</p>
<p></p>
<p><tags><tag kind="codeblock">￼</tag></tags><attribute identifier="syntax">mathematica</attribute>result = &lt;||&gt;</p>
<p><tags><tag kind="codeblock">￼</tag></tags>Do[</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	file = "~/Downloads/covid/covid_"&lt;&gt;ToString@file&lt;&gt;".csv";</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	Print["Loading... "&lt;&gt;file];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	data = Import[file, {"CSV", "Dataset"}, "HeaderLines"-&gt;1];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	dates = Counts[Normal@data[All, "FECHA_INGRESO"]];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	result = Merge[{result, dates}, Total],</p>
<p><tags><tag kind="codeblock">￼</tag></tags>{file, 1, 101}]</p>
<p><tags><tag kind="codeblock">￼</tag></tags></p>
<p><tags><tag kind="codeblock">￼</tag></tags>dates = Flatten /@ List @@@ Normal @ result;</p>
<p><tags><tag kind="codeblock">￼</tag></tags>Do[dates[[n]][[1]] = FromDateString[dates[[n]][[1]]], {n, 1, Length[dates]}];</p>
<p><tags><tag kind="codeblock">￼</tag></tags></p>
<p><tags><tag kind="codeblock">￼</tag></tags>Dplot[dates]</p>
<p></p>
<p>Overall, it plots an association that packs the engineered data for each file.</p>
<p></p>
<p>Achieved by creating an empty association filled with the outcomes of a process that is executed <element kind="inlineNative" startTag="~" endTag="~">\( n \)</element>  times when <element kind="inlineNative" startTag="~" endTag="~">\( n \)</element>   is the quantity of archives with the CSV form. </p>
<p></p>
<p>The process formats <element kind="inlineNative" startTag="~" endTag="~">\( n \)</element>  with a hardcoded path to open a file and load it into a dataset.</p>
<p></p>
<p>To prepare the information, it declares a list containing the values of the column <element kind="strong" startTag="**" endTag="**">FECHA<escape>\_</escape>INGRESO</element>, counts the number of occurrences of the values, stores the result to <element kind="strong" startTag="**" endTag="**">date</element> and, using <element kind="strong" startTag="**" endTag="**">Merge</element> with <element kind="strong" startTag="**" endTag="**">Total</element> , appends <element kind="strong" startTag="**" endTag="**">dates</element> to <element kind="strong" startTag="**" endTag="**">results</element>, merging the new dates as new keys or adding their values for already existing keys.</p>
<p></p>
<p>Finally, it transforms the association into a matrix of two columns, formatting the dates, for them to be objects instead of strings and be able to plot the matrix with the custom function <element kind="strong" startTag="**" endTag="**">Dplot</element>.</p>
<p></p>
<p><element kind="image"><attribute identifier="image">b4f8133a13fe4087bd669eda31796a6b</attribute></element></p>
<p><tags><tag kind="heading6">######</tag></tags><element kind="annotation"><attribute identifier="text"><string xml:space="preserve">
</string></attribute>Figure 1: Daily people registration over time</element></p>
<p></p>
<p><element kind="inlineNative" startTag="~" endTag="~">&lt;/br&gt;</element><element kind="strong" startTag="**" endTag="**">Confirmed cases</element></p>
<p></p>
<p>By implementing an algorithm almost identical to the first one, but changing the target column, we can get the number of confirmed COVID-19 cases, using a custom function, <element kind="strong" startTag="**" endTag="**"> PerformForEach</element>, to avoid some boilerplate to open and manage each cdv file:</p>
<p></p>
<p><tags><tag kind="codeblock">￼</tag></tags><attribute identifier="syntax">mathematica</attribute>PerformForEach["~/Downloads/covid", &lt;|</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	Pre -&gt; ((</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		result = &lt;||&gt;;</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	)&amp;),</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	Code -&gt; ((</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		datesCovid = Counts[Normal@#Data[Select[#"CLASIFICACION_FINAL" == 3 &amp;], "FECHA_INGRESO"]];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		result = Merge[{result, datesCovid}, Total];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	)&amp;),</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	Pos -&gt; ((</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		datesCovid = Flatten /@ List @@@ Normal @ result;</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		Do[datesCovid[[n]][[1]] = FromDateString[datesCovid[[n]][[1]]], {n, 1, Length[datesCovid]}];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		Print@Dplot[datesCovid];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	)&amp;)</p>
<p><tags><tag kind="codeblock">￼</tag></tags>|&gt;];</p>
<p></p>
<p><element kind="image"><attribute identifier="image">3082ba59175049b8b02244a5789b6d70</attribute></element></p>
<p><tags><tag kind="heading6">######</tag></tags><element kind="annotation"><attribute identifier="text"><string xml:space="preserve">
</string></attribute>Figure 2: Confirmed COVID-19 cases over time</element></p>
<p></p>
<p><element kind="inlineNative" startTag="~" endTag="~">&lt;/br&gt;</element><element kind="strong" startTag="**" endTag="**">Confirmed vs. Total</element></p>
<p></p>
<p>To get a better understanding of what is happening on both plots it’s necessary to make a comparison of some sort between the graphics, the simplest form is to plot the two of them in a single-axis space. This can be managed by using <element kind="strong" startTag="**" endTag="**">Show</element>.</p>
<p></p>
<p><tags><tag kind="codeblock">￼</tag></tags><attribute identifier="syntax">mathematica</attribute>Show[Dplot@dates, Dplot[datesCovid, PlotStyle-&gt; Darker@Red]]</p>
<p></p>
<p><element kind="image"><attribute identifier="image">b22f773063774ce09bec622565df10a9</attribute></element></p>
<p><tags><tag kind="heading6">######</tag></tags><element kind="annotation"><attribute identifier="text"><string xml:space="preserve">
</string></attribute>Figure 3: Total attendance registration and confirmed cases per day over time</element></p>
<p></p>
<p>Taking a look at <element kind="strong" startTag="**" endTag="**">Figure 3</element>, there appears to be a relation between the number of Mexicans attending sanity barracks and confirmed cases over time, which may evidence that COVID-19 “waves” are merely indicators of individuals presenting to treatment and diagnosis stations —maybe due to paranoia— and not because of the presence of actually a lot of infected.</p>
<p></p>
<p>With the purpose of getting a clearer idea of this last point, a method may be to view the percentage of people that tested positive for Covid of the 200% of people that attended a health center.</p>
<p></p>
<p><element kind="inlineNative" startTag="~" endTag="~">&lt;/br&gt;</element><element kind="strong" startTag="**" endTag="**">COVID-19 confirmed percent by day over time</element></p>
<p></p>
<p>To accomplish this, more code is needed. Since the arrays extracted from the dataset are in disorder, it’s necessary to sort them by date, like DateListPlot does. Then prepend zero values to the collection for both to have the same length, and late divide each element of the raw total established cases by the complete number of people.</p>
<p></p>
<p><tags><tag kind="codeblock">￼</tag></tags><attribute identifier="syntax">mathematica</attribute>rawdatesqc = {};</p>
<p><tags><tag kind="codeblock">￼</tag></tags>Do[AppendTo[rawdatesqc, e[[2]]],  {e, SortBy[datesCovid, AbsoluteTime[#[[1]]] &amp;]}];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>rawdatesqc = PrependTo[rawdatesqc, Table[0, 31+29]];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>rawdatesqc = Flatten[rawdatesqc];</p>
<p></p>
<p>Hence, first compile the patients with confirmed COVID-19, sorted by date and with some extra zeros at the beginning to match widths.</p>
<p></p>
<p><tags><tag kind="codeblock">￼</tag></tags><attribute identifier="syntax">mathematica</attribute>rawdatesq = {};</p>
<p><tags><tag kind="codeblock">￼</tag></tags>Do[AppendTo[rawdatesq, e[[2]]],  {e, SortBy[dates, AbsoluteTime[#[[1]]] &amp;]}];</p>
<p></p>
<p>Then we get the area of the number of people registered at an attendance center and fix by the day.</p>
<p></p>
<p><tags><tag kind="codeblock">￼</tag></tags><attribute identifier="syntax">mathematica</attribute>percentPerDate = {};</p>
<p><tags><tag kind="codeblock">￼</tag></tags>percents = N[rawdatesqc/rawdatesq * 100];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>Do[percentPerDate = AppendTo[percentPerDate, {SortBy[dates, AbsoluteTime[#[[1]]] &amp;][[i]][[1]], percents[[i]]}], {i, 1, Length[rawdatesq]}];</p>
<p></p>
<p>Finally, declare an array, populating it with the result of the division of confirmed by total of every index and prepend its corresponding day.</p>
<p></p>
<p><tags><tag kind="codeblock">￼</tag></tags><attribute identifier="syntax">mathematica</attribute>Dplot[percentPerDate, Filling -&gt; Top, YRange-&gt;{0,100}]</p>
<p></p>
<p><element kind="image"><attribute identifier="image">7fe4b2a58c6c4ecfbe4ed12bde78ad43</attribute></element></p>
<p><tags><tag kind="heading6">######</tag></tags><element kind="annotation"><attribute identifier="text"><string xml:space="preserve">
</string></attribute>Figure 4: Percent of confirmed cases per number of registrations over time</element></p>
<p></p>
<p>From this perspective, there appears to be two COVID-19 waves instead of three as displayed at <element kind="strong" startTag="**" endTag="**">Figure 3</element>.</p>
<p></p>
<p><element kind="inlineNative" startTag="~" endTag="~">&lt;/br&gt;</element><element kind="strong" startTag="**" endTag="**">Cases per Administrative Divisions</element></p>
<p></p>
<p>With a similar approach to the method used to count all confirmed cases, but with an extra check for the 32 entities of México. As an outcome, an association with 32 keys for each administrative division gained at the end of <element kind="strong" startTag="**" endTag="**">Code</element> instead of a single result for the whole country. </p>
<p></p>
<p><tags><tag kind="codeblock">￼</tag></tags><attribute identifier="syntax">mathematica</attribute>PerformForEach["~/Downloads/covid", &lt;|</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	Pre -&gt; ((</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		result = &lt;||&gt;;</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	)&amp;),</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	Code -&gt; ((</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		Do[</p>
<p><tags><tag kind="codeblock">￼</tag></tags>			entity = Counts[Normal@#Data[Select[#"CLASIFICACION_FINAL" == 3 &amp;&amp; #"ENTIDAD_UM" == en &amp;], "FECHA_INGRESO"] ];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>			If [KeyExistsQ[result, en], result[en] = Merge[{result[en], entity}, Total], result[en] = entity];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		,{en, 1, 32}]</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	)&amp;),</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	Pos -&gt; ((</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		entity = &lt;||&gt;;</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		plots = {};</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		Do[</p>
<p><tags><tag kind="codeblock">￼</tag></tags>			entity[en] = Flatten /@ List @@@ Normal @ result[en];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>			Do[entity[en][[n]][[1]] = FromDateString[entity[en][[n]][[1]]], {n, 1, Length[entity[en]]}];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>			plots = AppendTo[plots, Dplot[entity[en]]];</p>
<p><tags><tag kind="codeblock">￼</tag></tags>		,{en, 1, 32}]</p>
<p><tags><tag kind="codeblock">￼</tag></tags>	)&amp;)</p>
<p><tags><tag kind="codeblock">￼</tag></tags>|&gt;];</p>
<p></p>
<p>Then, a sum of all cases can be computed for each entity.</p>
<p></p>
<p><tags><tag kind="codeblock">￼</tag></tags><attribute identifier="syntax">mathematica</attribute>Table[Sum[e[[2]], {e, entity[en]}], {en, 1, 32}]</p>
<p></p>
<p>Returning:</p>
<p><escape>\{</escape>37876, 83146, 57416, 23697, 97912, 32851, 21214, 71485, 949633, 48989, 198388, 75604, 60673, 162487, 229096, 72058, 48098, 34019,  206653, 79510, 123996, 99596, 58782, 106373, 72865, 99407, 144732, 103770, 26673, 119370, 75034, 41756<escape>\}</escape></p>
<p></p>
<p><element kind="image"><attribute identifier="image">3d83e733ae7d417597901fa2d66d6fba</attribute></element></p>
<p><tags><tag kind="heading6">######</tag></tags><element kind="annotation"><attribute identifier="text"><string xml:space="preserve">
</string></attribute>Figure 5: Pie chart of total confirmed cases per administrative division</element></p>
<p></p>
<p><element kind="image"><attribute identifier="image">c64d57d090864d25b25a4721f585ce54</attribute></element></p>
<p><tags><tag kind="heading6">######</tag></tags><element kind="annotation"><attribute identifier="text"><string xml:space="preserve">
</string></attribute>Figure 6: Rectangle chart of total confirmed cases per administrative division</element></p>
<p></p>
<p><tags><tag kind="heading2">##</tag></tags>References</p>
<p></p>
<p><tags><tag>	</tag></tags><element kind="inlineNative" startTag="~" endTag="~">\( \ \ \ \ \ \ \ \)</element> 1.- </p>
</string>
</sheet>